# 患者反馈生成功能

## 功能概述

基于医生的批注和交互数据，通过AI生成面向患者的友好反馈摘要。

## 使用方式

### 方式一：在医生版报告中直接生成

1. 打开医生版HTML报告
2. 添加批注或完成交互操作（如复查安排、随访计划等）
3. 点击底部工具条的"生成患者反馈"按钮
4. 系统会在新窗口中显示患者友好的反馈内容

### 方式二：使用独立脚本生成

1. 从医生版报告导出批注JSON文件
2. 使用命令行工具生成患者反馈：

```bash
python generate_patient_feedback.py -i annotations.json -n "患者姓名"
```

**参数说明：**
- `-i, --input`: 医生导出的批注JSON文件路径（必需）
- `-o, --output`: 输出HTML文件路径（可选，默认自动生成）
- `-n, --patient-name`: 患者姓名（可选，默认为"患者"）

## 输出文件

- **HTML文件**: 美观的患者反馈页面，可直接发送给患者查看
- **JSON文件**: 结构化的反馈数据，便于后续处理或集成

## 功能特点

### 智能分析
- 解析医生的全局批注和章节批注
- 分析交互控件的选择（处置决策、随访安排等）
- 识别完成的健康教育项目
- 理解AI分析的医生确认情况

### 患者友好
- 使用温和、鼓励的语调
- 避免过于专业的医学术语
- 突出积极方面，温和提醒改进点
- 提供具体的行动建议

### 反馈内容结构
1. **整体评价**: 医生对患者情况的总体看法
2. **关注要点**: 需要改进或注意的地方
3. **下步行动**: 具体的后续行动计划
4. **鼓励话语**: 正面的激励和支持

## 示例

### 输入（医生批注）
```json
{
  "global": "患者整体情况良好，血压控制稳定。建议继续保持目前的治疗方案。",
  "interactions": {
    "adherence.follow": true,
    "adherence.period": "2周",
    "life.diet": true,
    "life.exercise": true
  }
}
```

### 输出（患者反馈）
- **整体评价**: "您目前的血压控制得很好，整体情况稳定，医生对您的配合很满意。"
- **关注要点**: "继续保持健康的饮食和规律运动，这对控制血压非常重要。"
- **下步行动**: "两周后请按时参加随访，继续监测血压变化。"
- **鼓励话语**: "您已经做得很好了，继续坚持下去！"

## 技术架构

- **AI模型**: 使用Qwen模型进行自然语言生成
- **数据解析**: 智能解析医生的结构化和非结构化反馈
- **模板生成**: 生成美观的HTML页面，适合患者查看
- **多模式支持**: 支持Web界面和命令行两种使用方式

## 文件说明

- `src/patient_feedback.py`: 患者反馈生成核心模块
- `generate_patient_feedback.py`: 独立的命令行工具
- `sample_annotations.json`: 示例批注数据文件

## 部署建议

在生产环境中，建议：

1. 将AI调用改为异步处理，避免用户等待
2. 添加批注数据的验证和清洗
3. 支持多种AI模型的切换
4. 添加患者反馈的模板自定义功能
5. 集成到现有的医疗信息系统中
