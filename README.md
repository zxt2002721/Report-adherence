# æ…¢æ€§ç—…ç®¡ç†æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ

ä¸€ä¸ªåŸºäºAIçš„æ™ºèƒ½æ…¢æ€§ç—…æ‚£è€…æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿï¼Œæ”¯æŒæœè¯ä¾ä»æ€§è¯„ä¼°å’Œåˆ†è¯Šè¯„ä¼°ï¼Œæä¾›å®Œæ•´çš„Webç•Œé¢å’ŒAPIæœåŠ¡ã€‚

## ğŸ¯ ç³»ç»Ÿç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆ**: åŸºäºAIåˆ†æçš„ä¸ªæ€§åŒ–æ‚£è€…æŠ¥å‘Š
- **å¤šç§æŠ¥å‘Šç±»å‹**: æ”¯æŒæœè¯ä¾ä»æ€§è¯„ä¼°å’Œåˆ†è¯Šè¯„ä¼°
- **ğŸ†• ç´§è¿«ç¨‹åº¦åˆ†çº§**: AIè‡ªåŠ¨åˆ¤æ–­æ‚£è€…æƒ…å†µæ˜¯å¦éœ€è¦åŒ»ç”Ÿç«‹å³ä»‹å…¥ï¼ˆä¸‰çº§åˆ†ç±»ï¼‰
- **å®æ—¶æ•°æ®å¤„ç†**: ä»çœŸå®æ‚£è€…å¯¹è¯æ•°æ®ä¸­æå–å…³é”®ä¿¡æ¯
- **å¯è§†åŒ–å›¾è¡¨**: è‡ªåŠ¨ç”Ÿæˆå¥åº·è¶‹åŠ¿å›¾è¡¨å’Œç»Ÿè®¡å›¾
- **Webç•Œé¢**: ç®€æ´æ˜“ç”¨çš„å‰ç«¯æ“ä½œç•Œé¢
- **RESTful API**: å®Œæ•´çš„APIæ¥å£æ”¯æŒ

### æŠ€æœ¯æ¶æ„
- **åç«¯**: Python Flask + æ¨¡å—åŒ–æŠ¥å‘Šç”Ÿæˆå™¨
- **å‰ç«¯**: ç°ä»£HTML5 + JavaScript (æ— æ¡†æ¶ä¾èµ–)
- **AIåˆ†æ**: é›†æˆæ™ºèƒ½åˆ†æå¼•æ“ï¼ˆå«ç´§è¿«ç¨‹åº¦è¯„ä¼°ï¼‰
- **æ•°æ®å¯è§†åŒ–**: Matplotlibå›¾è¡¨ç”Ÿæˆ
- **æŠ¥å‘Šæ ¼å¼**: HTMLæ ¼å¼ï¼Œæ”¯æŒæ‰“å°å’Œåˆ†äº«

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### ç¯å¢ƒè¦æ±‚
- Python 3.7+
- ç°ä»£Webæµè§ˆå™¨ (Chrome 60+, Firefox 60+, Safari 12+, Edge 79+)

### Pythonä¾èµ–
```bash
pip install flask jinja2 matplotlib pandas markdown
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç³»ç»Ÿæ£€æŸ¥
```bash
# è¿è¡Œç³»ç»Ÿæµ‹è¯•ï¼Œç¡®ä¿æ‰€æœ‰ç»„ä»¶æ­£å¸¸
python test_system.py
```

### 2. å¯åŠ¨ç³»ç»Ÿ
```bash
# æ–¹æ³•1: ä¸€é”®å¯åŠ¨ (æ¨è)
python start_simple.py

# æ–¹æ³•2: æ‰‹åŠ¨å¯åŠ¨
python simple_server.py
# ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ frontend/simple.html
```

### 3. ä½¿ç”¨ç³»ç»Ÿ
1. **è®¿é—®ç•Œé¢**: ç³»ç»Ÿå¯åŠ¨åä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
2. **è¾“å…¥æ‚£è€…ID**: æ”¯æŒ P001, P002, P003
3. **é€‰æ‹©æŠ¥å‘Šç±»å‹**: 
   - æœè¯ä¾ä»æ€§è¯„ä¼° (compliance)
   - åˆ†è¯Šè¯„ä¼° (triage)
4. **ç”ŸæˆæŠ¥å‘Š**: ç‚¹å‡»ç”ŸæˆæŒ‰é’®ï¼Œç­‰å¾…AIå¤„ç†
5. **æŸ¥çœ‹ç»“æœ**: ç‚¹å‡»é“¾æ¥é¢„è§ˆå®Œæ•´æŠ¥å‘Š

## ğŸ“ ç›®å½•ç»“æ„

```
æ…¢æ€§ç—…ç®¡ç†ç³»ç»Ÿ/
â”œâ”€â”€ README.md                    # æœ¬æ–‡ä»¶
â”œâ”€â”€ SIMPLE_README.md             # ç®€åŒ–ç‰ˆè¯´æ˜
â”œâ”€â”€ test_system.py               # ç³»ç»Ÿæµ‹è¯•è„šæœ¬
â”œâ”€â”€ start_simple.py              # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ simple_server.py             # ç®€åŒ–ç‰ˆAPIæœåŠ¡å™¨
â”œâ”€â”€ report.py                    # å‘½ä»¤è¡ŒæŠ¥å‘Šç”Ÿæˆå™¨
â”‚
â”œâ”€â”€ frontend/                    # å‰ç«¯ç•Œé¢
â”‚   â”œâ”€â”€ simple.html              # ç®€åŒ–ç‰ˆWebç•Œé¢
â”‚   â”œâ”€â”€ index.html               # å®Œæ•´ç‰ˆç®¡ç†ç•Œé¢
â”‚   â”œâ”€â”€ css/                     # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ js/                      # JavaScriptæ¨¡å—
â”‚
â”œâ”€â”€ report_modules/              # æŠ¥å‘Šç”Ÿæˆæ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py              # å·¥å‚æ¨¡å¼å…¥å£
â”‚   â”œâ”€â”€ base/                    # åŸºç¡€æŠ½è±¡ç±»
â”‚   â”œâ”€â”€ common/                  # å…±äº«å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ compliance/              # ä¾ä»æ€§è¯„ä¼°æ¨¡å—
â”‚   â””â”€â”€ triage/                  # åˆ†è¯Šè¯„ä¼°æ¨¡å—
â”‚
â”œâ”€â”€ data/                        # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ output/
â”‚       â””â”€â”€ dialogue_data/       # æ‚£è€…å¯¹è¯æ•°æ®
â”‚
â””â”€â”€ report/                      # æŠ¥å‘Šè¾“å‡ºç›®å½•
    â””â”€â”€ output/                  # ç”Ÿæˆçš„HTMLæŠ¥å‘Š
```

## ğŸ§ª æµ‹è¯•æ•°æ®

ç³»ç»Ÿå†…ç½®äº†3ä¸ªæµ‹è¯•æ‚£è€…çš„æ•°æ®ï¼š

| æ‚£è€…ID | å§“å | å¹´é¾„ | æ€§åˆ« | ä¸»è¦è¯Šæ–­ | æ•°æ®çŠ¶æ€ |
|--------|------|------|------|----------|----------|
| P001   | å¼ ä¸‰ | 65å² | ç”·   | 2å‹ç³–å°¿ç—…,é«˜è¡€å‹ | âœ… å¯ç”¨ |
| P002   | æå›› | 58å² | å¥³   | é«˜è¡€å‹,å† å¿ƒç—… | âœ… å¯ç”¨ |
| P003   | ç‹äº” | 72å² | ç”·   | æ…¢æ€§è‚¾ç—…,ç³–å°¿ç—… | âœ… å¯ç”¨ |

## ğŸ”§ APIæ¥å£

### åŸºç¡€æ¥å£
```bash
# å¥åº·æ£€æŸ¥
GET http://localhost:5000/api/health

# è·å–æ‚£è€…ä¿¡æ¯
GET http://localhost:5000/api/patients/{patient_id}

# ç”ŸæˆæŠ¥å‘Š
POST http://localhost:5000/api/generate-report
Content-Type: application/json
{
    "patientId": "P001",
    "reportType": "compliance"
}

# æŸ¥çœ‹æŠ¥å‘Š
GET http://localhost:5000/api/reports/{patient_id}/{filename}
```

### ç¤ºä¾‹è°ƒç”¨
```python
import requests

# è·å–æ‚£è€…ä¿¡æ¯
response = requests.get('http://localhost:5000/api/patients/P001')
patient = response.json()

# ç”ŸæˆæŠ¥å‘Š
report_request = {
    "patientId": "P001", 
    "reportType": "compliance"
}
response = requests.post('http://localhost:5000/api/generate-report', json=report_request)
result = response.json()

print(f"æŠ¥å‘ŠURL: http://localhost:5000{result['reportPath']}")
```

## ğŸ“Š æŠ¥å‘Šç±»å‹è¯¦è§£

### 1. æœè¯ä¾ä»æ€§è¯„ä¼° (compliance)
- **åŠŸèƒ½**: åˆ†ææ‚£è€…çš„æœè¯è¡Œä¸ºå’Œä¾ä»æ€§
- **æ•°æ®æº**: æ‚£è€…å¯¹è¯è®°å½•ã€ç”¨è¯è®°å½•
- **è¾“å‡ºå†…å®¹**:
  - ä¾ä»æ€§è¯„åˆ†å’Œç»Ÿè®¡
  - ç”¨è¯æ—¶é—´åˆ†æå›¾è¡¨
  - ä¸ªæ€§åŒ–å»ºè®®å’Œæé†’
  - å¥åº·æŒ‡æ ‡è¶‹åŠ¿å›¾

### 2. åˆ†è¯Šè¯„ä¼° (triage)
- **åŠŸèƒ½**: è¯„ä¼°æ‚£è€…çš„ç´§æ€¥ç¨‹åº¦å’Œå°±åŒ»éœ€æ±‚
- **æ•°æ®æº**: ç—‡çŠ¶æè¿°ã€ç”Ÿç†æŒ‡æ ‡
- **è¾“å‡ºå†…å®¹**:
  - é£é™©ç­‰çº§è¯„ä¼°
  - ç—‡çŠ¶ä¸¥é‡ç¨‹åº¦åˆ†æ
  - å°±åŒ»å»ºè®®å’Œä¼˜å…ˆçº§
  - ç›¸å…³åŒ»ç–—èµ„æºæ¨è

## âš™ï¸ é…ç½®å’Œè‡ªå®šä¹‰

### ä¿®æ”¹æ‚£è€…æ•°æ®
åœ¨ `simple_server.py` ä¸­ä¿®æ”¹ `PATIENT_INFO` å­—å…¸ï¼š

```python
PATIENT_INFO = {
    'P004': {
        'id': 'P004',
        'name': 'æ–°æ‚£è€…',
        'age': 45,
        'gender': 'å¥³',
        'diagnosis': 'é«˜è¡€å‹',
        'dataFile': 'your_data_file_id'
    }
}
```

### è‡ªå®šä¹‰æŠ¥å‘Šæ¨¡æ¿
æŠ¥å‘Šæ¨¡æ¿ä½äº `report_modules/*/templates/` ç›®å½•ä¸­ï¼Œæ”¯æŒJinja2æ¨¡æ¿è¯­æ³•ã€‚

### APIé…ç½®
ä¿®æ”¹ `simple_server.py` ä¸­çš„é…ç½®ï¼š

```python
# ä¿®æ”¹æœåŠ¡å™¨ç«¯å£
app.run(host='0.0.0.0', port=8000)

# ä¿®æ”¹æ•°æ®è·¯å¾„
DATA_DIR = Path('your_custom_data_path')
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ¨¡å—å¯¼å…¥å¤±è´¥
**é—®é¢˜**: `ModuleNotFoundError: No module named 'report_modules'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥å½“å‰ç›®å½•
pwd
# åº”è¯¥åœ¨ report_paper ç›®å½•ä¸­

# æ£€æŸ¥Pythonè·¯å¾„
python -c "import sys; print(sys.path)"

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

#### 2. æ•°æ®æ–‡ä»¶ä¸å­˜åœ¨
**é—®é¢˜**: `æ‚£è€…æ•°æ®æ–‡ä»¶ä¸å­˜åœ¨`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æ•°æ®ç›®å½•
ls data/output/dialogue_data/

# è¿è¡Œç³»ç»Ÿæµ‹è¯•
python test_system.py
```

#### 3. ç«¯å£è¢«å ç”¨
**é—®é¢˜**: `Address already in use`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# Windows
netstat -ano | findstr :5000
taskkill /PID <PID> /F

# æˆ–ä¿®æ”¹ç«¯å£å·
# åœ¨ simple_server.py ä¸­ä¿®æ”¹ app.run(port=8000)
```

#### 4. æŠ¥å‘Šç”Ÿæˆå¤±è´¥
**é—®é¢˜**: AIåˆ†ææˆ–å›¾è¡¨ç”Ÿæˆé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ä¾èµ–
pip install matplotlib pandas jinja2

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
python -c "
from report_modules import ReportFactory
try:
    gen = ReportFactory.create('compliance', 'test')
    print('âœ… æ¨¡å—æ­£å¸¸')
except Exception as e:
    print('âŒ é”™è¯¯:', e)
"
```

#### 5. æµè§ˆå™¨è®¿é—®é—®é¢˜
**é—®é¢˜**: æ— æ³•è®¿é—®å‰ç«¯ç•Œé¢

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿ä½¿ç”¨ç°ä»£æµè§ˆå™¨
- æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†JavaScript
- å°è¯•ä¸åŒæµè§ˆå™¨
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### æ—¥å¿—å’Œè°ƒè¯•

#### å¯ç”¨è¯¦ç»†æ—¥å¿—
```python
# åœ¨ simple_server.py å¼€å¤´æ·»åŠ 
import logging
logging.basicConfig(level=logging.DEBUG)
```

#### æŸ¥çœ‹ç”Ÿæˆè¿‡ç¨‹
```bash
# ç›´æ¥å‘½ä»¤è¡Œç”ŸæˆæŠ¥å‘Š
python report.py --id P001 --type compliance

# æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶
ls report/output/
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### å¼€å‘ç¯å¢ƒ
```bash
# å…‹éš†é¡¹ç›®
git clone <repository>
cd report_paper

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œæµ‹è¯•
python test_system.py

# å¯åŠ¨æœåŠ¡
python start_simple.py
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# ä½¿ç”¨gunicornéƒ¨ç½²
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 simple_server:app

# æˆ–ä½¿ç”¨Docker
docker build -t chronic-disease-reports .
docker run -p 5000:5000 chronic-disease-reports
```

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„æŠ¥å‘Šç±»å‹
1. åœ¨ `report_modules/` ä¸‹åˆ›å»ºæ–°ç›®å½•
2. å®ç°ç»§æ‰¿è‡ª `BaseReportGenerator` çš„ç”Ÿæˆå™¨ç±»
3. åœ¨ `report_modules/__init__.py` ä¸­æ³¨å†Œæ–°ç±»å‹

### æ‰©å±•APIåŠŸèƒ½
1. åœ¨ `simple_server.py` ä¸­æ·»åŠ æ–°çš„è·¯ç”±
2. æ›´æ–°å‰ç«¯ JavaScript è°ƒç”¨
3. æ·»åŠ ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹

### è‡ªå®šä¹‰å‰ç«¯ç•Œé¢
- ä¿®æ”¹ `frontend/simple.html` çš„æ ·å¼å’Œå¸ƒå±€
- æ‰©å±• JavaScript åŠŸèƒ½
- æ·»åŠ æ–°çš„äº¤äº’ç»„ä»¶

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ LICENSE æ–‡ä»¶

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘æµç¨‹
1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤å˜æ›´
4. è¿è¡Œæµ‹è¯•
5. æäº¤ Pull Request

## ğŸ†• æ–°åŠŸèƒ½ï¼šç´§è¿«ç¨‹åº¦åˆ†çº§

### æ¦‚è¿°
è‡ªåŠ¨åˆ¤æ–­æ‚£è€…æƒ…å†µæ˜¯å¦éœ€è¦åŒ»ç”Ÿç«‹å³ä»‹å…¥å†³ç­–çš„æ™ºèƒ½åˆ†çº§ç³»ç»Ÿã€‚

### ä¸‰çº§åˆ†ç±»
- **ï¿½ ç´§æ€¥çº§ (urgent)**: éœ€è¦åŒ»ç”Ÿç«‹å³ä»‹å…¥å†³ç­–
  - ç”Ÿç†æŒ‡æ ‡ä¸¥é‡å¼‚å¸¸ã€å±é™©è¯ç‰©æ¼æœã€å¤šé‡é«˜å±å› ç´ 
  - é£é™©è¯„åˆ†ï¼š70-100åˆ†ï¼Œå»ºè®®3-7å¤©éšè®¿
  
- **ğŸŸ¡ å…³æ³¨çº§ (attention)**: éœ€è¦åŒ»ç”Ÿå®šæœŸå®¡é˜…  
  - æŒ‡æ ‡è½»ä¸­åº¦å¼‚å¸¸ã€ä¾ä»æ€§ä¸ç¨³å®šã€ç”Ÿæ´»æ–¹å¼é—®é¢˜
  - é£é™©è¯„åˆ†ï¼š40-69åˆ†ï¼Œå»ºè®®7-14å¤©éšè®¿
  
- **ğŸŸ¢ ç¨³å®šçº§ (stable)**: AIå»ºè®®å³å¯
  - æ‰€æœ‰æŒ‡æ ‡è¾¾æ ‡ã€ä¾ä»æ€§è‰¯å¥½ã€ç—…æƒ…ç¨³å®š
  - é£é™©è¯„åˆ†ï¼š0-39åˆ†ï¼Œå»ºè®®14-30å¤©éšè®¿

### æ ¸å¿ƒç‰¹æ€§
- âœ… **LLMæ™ºèƒ½è¯„ä¼°**: åŸºäºæ‚£è€…æ•°æ®çš„AIåˆ¤æ–­
- âœ… **è§„åˆ™å¼•æ“æ ¡éªŒ**: é˜²æ­¢LLMè¯¯åˆ¤çš„äºŒæ¬¡éªŒè¯
- âœ… **åŒ»ç”Ÿæ‰‹åŠ¨è°ƒæ•´**: æ”¯æŒåŒ»ç”Ÿä¿®æ­£AIåˆ¤æ–­
- âœ… **ä¸ç¡®å®šå¤„ç†**: åˆ¤æ–­ä¸ç¡®å®šç»Ÿä¸€ä¸ºå…³æ³¨çº§

### å¿«é€Ÿä½¿ç”¨

#### Python API
```python
from report_modules.compliance import urgency_classifier
from report_modules.common import data_loader

# åŠ è½½æ•°æ®
memory, dialogues, df_patient = data_loader.load_patient_data(patient_id)

# å¿«é€Ÿè¯„ä¼°
assessment = urgency_classifier.quick_classify(
    patient_id="P001",
    memory=memory,
    df_patient=df_patient
)

print(f"çº§åˆ«: {assessment.get_level_text()}")
print(f"è¯„åˆ†: {assessment.risk_score}")
print(f"ç†ç”±: {assessment.reasoning}")
```

#### æµ‹è¯•åŠŸèƒ½
```bash
# å®Œæ•´æµ‹è¯•
python test_urgency_classifier.py

# å¿«é€Ÿæµ‹è¯•
python test_urgency_classifier.py --quick
```

#### APIç«¯ç‚¹
```bash
# åŒ»ç”Ÿæ‰‹åŠ¨è°ƒæ•´ç´§è¿«ç¨‹åº¦
PATCH http://localhost:5000/api/reports/{report_id}/urgency
Content-Type: application/json
{
    "patient_id": "P001",
    "new_level": "urgent",
    "reason": "æ‚£è€…å‡ºç°æ–°ç—‡çŠ¶"
}

# è·å–ç´§è¿«ç¨‹åº¦ç»Ÿè®¡
GET http://localhost:5000/api/urgency/stats
```

### è¯¦ç»†æ–‡æ¡£
- ğŸ“– [åŠŸèƒ½ä½¿ç”¨æ–‡æ¡£](URGENCY_FEATURE.md)
- ğŸ“– [æŠ€æœ¯å®ç°æ–‡æ¡£](URGENCY_IMPLEMENTATION.md)

---

## ï¿½ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬ README çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. è¿è¡Œ `python test_system.py` æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è¾“å‡º
4. æäº¤ GitHub Issue

---

**æœ€åæ›´æ–°**: 2025å¹´10æœˆ16æ—¥
**ç‰ˆæœ¬**: 2.1.0 (æ–°å¢ç´§è¿«ç¨‹åº¦åˆ†çº§åŠŸèƒ½)
**ä½œè€…**: æ…¢æ€§ç—…ç®¡ç†ç³»ç»Ÿå›¢é˜Ÿ